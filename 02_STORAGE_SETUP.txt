-- ============================================
-- STORAGE BUCKET SETUP
-- FÃ¼r PDF-Speicherung der Korrekturrechnungen
-- ============================================
--
-- WICHTIG: Dieser Teil kann NICHT per SQL ausgefÃ¼hrt werden!
-- Du musst das manuell im Supabase Dashboard machen.
--
-- ============================================

ğŸ“¦ STORAGE BUCKET ERSTELLEN:

1. Gehe zu: https://supabase.com/dashboard/project/jkipppgvcsucrdzjedwo/storage/buckets

2. Klicke auf "New Bucket" (grÃ¼ner Button oben rechts)

3. Einstellungen:
   Name: korrekturrechnungen
   Public: âŒ AUS (Bucket ist privat)
   File size limit: 50 MB (Standard ist okay)
   Allowed MIME types: application/pdf (oder leer lassen fÃ¼r alle)

4. Klicke auf "Create bucket"

5. âœ… Fertig!

-- ============================================
-- STORAGE POLICIES (automatisch Ã¼ber SQL)
-- ============================================
-- Diese Policies erlauben authenticated users das Hoch- und Herunterladen

-- Policy: Upload erlauben
INSERT INTO storage.policies (name, bucket_id, definition, command)
VALUES (
  'Allow authenticated users to upload PDFs',
  'korrekturrechnungen',
  '(bucket_id = ''korrekturrechnungen''::text)',
  'INSERT'
);

-- Policy: Download erlauben  
INSERT INTO storage.policies (name, bucket_id, definition, command)
VALUES (
  'Allow authenticated users to read PDFs',
  'korrekturrechnungen',
  '(bucket_id = ''korrekturrechnungen''::text)',
  'SELECT'
);

-- Policy: LÃ¶schen erlauben (falls nÃ¶tig)
INSERT INTO storage.policies (name, bucket_id, definition, command)
VALUES (
  'Allow authenticated users to delete PDFs',
  'korrekturrechnungen',
  '(bucket_id = ''korrekturrechnungen''::text)',
  'DELETE'
);

-- ============================================
-- ALTERNATIV: Policies Ã¼ber Dashboard
-- ============================================
-- Falls die SQL-Policies nicht funktionieren:
--
-- 1. Gehe zu Storage â†’ korrekturrechnungen
-- 2. Klicke auf "Policies" (rechts)
-- 3. Erstelle New Policy fÃ¼r:
--    - INSERT (Upload)
--    - SELECT (Download)
--    - DELETE (Optional)
-- 4. Als Target role: authenticated
-- 5. Policy check: return true
--
-- ============================================

âœ… NACH DEM SETUP:

Die Storage-Struktur sieht dann so aus:

storage/
â””â”€â”€ korrekturrechnungen/
    â”œâ”€â”€ 2025/
    â”‚   â”œâ”€â”€ 01/
    â”‚   â”‚   â”œâ”€â”€ ewert_2025-01_korrektur.pdf
    â”‚   â”‚   â””â”€â”€ mueller_2025-01_korrektur.pdf
    â”‚   â””â”€â”€ 02/
    â”‚       â””â”€â”€ ewert_2025-02_korrektur.pdf
    â””â”€â”€ 2026/
        â””â”€â”€ ...

Die URLs sehen dann so aus:
https://jkipppgvcsucrdzjedwo.supabase.co/storage/v1/object/public/korrekturrechnungen/2025/01/ewert_2025-01_korrektur.pdf

-- ============================================
-- TEST: Upload funktioniert?
-- ============================================
-- Im Frontend kannst du testen mit:

/*
import { createClient } from '@supabase/supabase-js'

const supabase = createClient(
  'https://jkipppgvcsucrdzjedwo.supabase.co',
  'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...'
)

// PDF hochladen
const { data, error } = await supabase.storage
  .from('korrekturrechnungen')
  .upload('2025/01/test.pdf', pdfFile, {
    contentType: 'application/pdf',
    upsert: false
  })

if (error) {
  console.error('Upload fehler:', error)
} else {
  console.log('âœ“ PDF hochgeladen:', data.path)
}
*/

-- ============================================
